# System Administration


## Contents
  * [Linux System](#System)
  * [Administration](#Administration)
  * [High Availability](#HA)
  * [Service](#Service)
  * [Storage](#Storage)


<br/><a name="System"></a>
## Linux System
#### system fundamental
    ===============================================================================================
    System fundamental
    ===============================================================================================
    - Kernel
      $ cat /proc/modules        : running module by current kernel
      $ cat /etc/modprob.d       : configuration data for modprod
      $ uname -r                 : print of current version of kernel
      $ lsmod | grep xfs	       : show info. about loaded xfs modules
      $ modinfo          	       : print of loaded modules in detail (with su)
      $ modprobe xfs             : load xfs module
      $ modprobe -r kvm	         : extract kvm module
      $ depmod -n 		           : wie depmod die Datei modules.dep konfig.

      Kernel location? Module des Kernels
      $ cat /lib/modules/<kernel version>/xxx

      kernel-Quelldateien
      $ /usr/src/linux-2.6.11.4-21.9
      Patch of kernel
      $ bzip2 -dc patch-2.6.39-rc4.bz2 | patch -p1 --dry-run
      Modify kernel paramaters at runtime, listed under /proc/sys/
      $ sysctl -w net.ipv6.conf.all.forwarding=1  : write into /proc/sys/net../forwarding
      $ sysctl -w net.ipv6.conf.all.forwarding=1  : write into /proc/sys/net../forwarding
      $ sysctl kernel.shmmax=212222222            : write into /proc/sys/kernel/shmmax

    - /proc
      Prozessdateisystem, runtime kernel module infromation
      $ cat /proc/cmdline        : from the bootloader to the kernel
      $ cat /proc/interrupts     : Info. about IRQs
      $ cat /proc/ioports        : Info. about I/O ports

    - /sys
      benutzer Treibermodell des laufendern Kernels, dynamische generiert wird

    - /dev
      udev            : To manage the /dev tree
      rdev            : query/set image root device, swap, RAM size, or video mode
      /dev/mapper     : hold device files related to LVM and RAID configuration
      udevadm monitor : new monitor

    - /usr
      unix system resource - suggest read only
      executable programs that are not needed on boot

    - /var
      temporally used system related files
      /var/log           : system log files
      /var/spool/mail    : grosser platz empfolen
      /var/named         : DNS zone configuration file
      /var/spool/cron    : cron temporal configuration data
      /var/log/messages  : Hauptprotokolldatei in Linux
      /var/log/syslog    : ausser bei Debian und Derivaten

    - /boot
      To have GRUB rescan all of the devices, the device.map
      /boot/grub/device.map          : generated by grub-mkdevicemap
      This file tell the paths of the fs partitions in the GRUB syntax

    - initrd (init ram disk)
      In der initrd befinden sich Kernel-module, die Linux beim Boot-vorgang benoetigt.
      Die initrd wird von Kernel beim System start in den Hauptspeicher geladen
      Die initrd muss bei jedem Kernel-Update nue erstellt werden

    - Drei Wesentliche Initialisierungsverfahren fuer den Linux-Systemstart:
      SysVinit (wird kamm mehr benutzt)                 : linux system
      Upstart  (Ubuntu, in zwischen night mehr aktuell) : linux system
      Systemd  (inzwischen von allen grossen Distributionen eingesetzt)

    - SysVinit or init:
      $ cat /etc/inittab    : main configuration file

      /etc/init.d/      : init process or
      /etc/rc.d/        : init process
      /etc/init.d/rc0.d : symbolic link of /etc/init.d/*  or
      /etc/rc0.d        : symbolic link of /etc/init.d/*

      $ telinit q    : read inittab configuration again and go back to previous state
                       without restart, tell init to re-examine the /etc/inittab
      $ update-rd.d  : install the init script links, use update-rc.d (Debian)
      $ chkconfig    : install and remove the init script links, use this (RedHat)
      $ sysv-rc-conf : command for the runlevel behavior for various services
      $ service --status-all

    - Systemd
      $ Systemctl start|stop|status <Subsystem>
      wenn Sie systemd, dann kommt journald & journalctl

    - How do I know whether systemd, SysVinit or upstart is used for system start?
      $ ps -A
      $ pstree
      $ sudo stat /proc/1/exe
      $ rpm -qf /sbin/init

    - Distribution Packages
      apt-get, dpkg, yum, rpm

    - Was muss gesichert werden?
      /bin    : backup
      /boot   : backup
      /etc    : backup, but no /etc/mtab
      /home   : backup
      /lib    : backup
      /opt    : backup
      /root   : backup
      /sbin   : backup
      /usr    : backup
      /var    : backup weil mailservern
      /sys    : no
      /dev    : no
      /mnt    : no
      /proc   : no
      /tmp    : no


<br/><a name="Administration"></a>
## Administration
Technical Recommendations:
  * Software Sources and Installation
  * Software and System Maintenance
  * Service Management
  * Bootstrapping systems
  * Logging
  * User and Group
  * Tools
  * Scripting
  * FileSystem locations
  * Web Servers
  * Security
  * SSH
  * SSL/TLS
  * VPN

#### Initial setup
    ===============================================================================================
    Initial setup after installation (based on ubuntu)
    ===============================================================================================
    1. root login
      $ ssh root@123.456.789.100
      |
      | warning..... bla blaa
      |
      $ ssh-keygen -R 123.456.789.100    : remove old key for root of 123.456.789.100
      $ eval `ssh-agent -s`              : check ssh-agent of local machine
      $ ssh-add ~/.ssh/id_rsa            : add private key to local machine
      $ ssh root@123.456.789.100         : try again, now OK with root!

    2. create user demo, who has root privileges
      $ adduser demo

    3. root privileges
      $ gpasswd -a demo sudo

    4. Add Public Key Authentication to demo user  : this is realy interesting!
      Generate a Key Pair
      $ ssh-keygen
      Enter file in which to save the key (/Users/localuser/.ssh/id_rsa): <enter>
      | ~/.ssh/id_rsa        (private key)
      | ~/.ssh/id_ras.pub    (public key)

      Copy the Public Key,
      $ ssh-copy-id demo@SERVER_IP_ADDRESS
      or
      $ cat ~/.ssh/id_rsa.pub
      | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAA...rggpFmu3HbXBnWSUdf localuser@machine.local
      | ctrl + c
      $ su - demo
      $ mkdir .ssh
      $ chmod 700 .ssh
      $ nano .ssh/authorized_keys
      | ctrl + v
      $ chmod 600 .ssh/authorized_keys

    5. Configure SSH Daemon
      $ nano /etc/ssh/sshd_config
      | PermitRootLogin no                : disabling remote root login is highly recommended

    6. Reload SSH
      $ service ssh restart
      $ ssh demo@SERVER_IP_ADDRESS        : it work! login with demo accout from local to server

    Optional) additional Recommended Steps
    7. Firewall policies
      $ sudo aptitude install ufw
      $ sudo ufw status

      $ sudo ufw allow ssh                : to configure your firewall policies
      $ sudo ufw allow 4444/tcp           : extra SSH 2222
      $ sudo ufw allow 80/tcp             : HTTP
      $ sudo ufw allow 443/tcp            : SSL/TLS
      $ sudo ufw allow 25/tcp             : SMTP
      $ sudo ufw allow 21/tcp             : ftp
      $ sudo ufw show added               : finalized
      $ sudo ufw enable                   : confirm then type "y"
      $ sudo ufw allow from 192.168.255.255
      $ sudo ufw default deny incoming
      $ sudo ufw default deny outgoing
      $ sudo ufw delete allow 80/tcp
      $ sudo ufw delete allow 1000:2000/tcp

    8. Configure Timezones and Network Time Protocol Synchronization
      $ sudo dpkg-reconfigure tzdata
      $ sudo apt-get update
      $ sudo apt-get install ntp

    9. Create a Swap File
      $ sudo fallocate -l 4G /swapfile
      $ sudo chmod 600 /swapfile
      $ sudo mkswap /swapfile
      $ sudo swapon /swapfile
      $ sudo sh -c 'echo "/swapfile none swap sw 0 0" >> /etc/fstab'

#### Bash and command set
    ===============================================================================================
    Bash and command
    ===============================================================================================
    - Wenn ich Hilfe brauche unbekannte Programm Name!
      $ whatis <command>         : sucht Erklaerung der Befehl                            
      $ apropos <command>        : search the whatis database for complete words with apropos
      $ whereis <command>        : zeigt Pfade zu Binaer und /oder Konfigurationsdateien
      $ which <command>          : zeigt Pfade zu ausfuehrbaren Dateien.                     
      $ man -k <command>         : Pfade der Manpages und Pfade zu Programmquellen

      $ ls -l 'which locate'     : list of location indicated by 'which locate'

    - Useful command for administration
      $ expand    : Converts tabs to spaces
      $ unexpand  : Converts spaces to tab
      $ fmt       : a formatter for simplifying and optimizing text files
      $ nl        : numbers of lines of files
      $ wc        : counts of bytes, characers, words and lines of a file
      $ sort      : sort lines of text files alphabetically
      $ uniq      : removes consecutive duplicate lines
      $ split     : splits a file into different groups/files
      $ cut       : cut the field
      $ paste     : horizontalles cat, paste together lines on a file into vertical columns
      $ join      : horizontalles cat, prints a pair of input lines
      $ pr        : Convertsa text file for printing few page printing
      $ stat      : Status of this files who access, modify, etc
      $ file      : show info about file
      $ type (ls, echo, firefox)         : type zeigt fuer ausfuehrbare Dateien


#### Administration fundamental
    ===============================================================================================
    Administration fundamental
    ===============================================================================================
    - User and group
      /etc/passwd
      /etc/shadow
      /etc/group

      $ id kang         : display UID and GID
      $ groups          : list of all group for this user

      Necessariness tools and tips for security
      $ find / -perm -u+s           : SUID bit
      $ find / -perm +4000 -type f  : list of files with SUID bit
      $ find / -perm -g+s           : GUID bit
      $ find /usr -uid 0            : owned by root

      $ useradd              : without -m means NO home directoy
      $ adduser              : some distribution also possible
      $ userdel              : delete recursively home and also mail spool
      $ usermod              : modification of user account

      $ chage -l kang        : administrative tool for passwd and expiring date
      # chfn & finger        : change personal data as like name, telefone, office number
      $ newgrp newgroup      : change primary group by newgroup from normal user
      $ groupadd
      $ groupdel
      $ groupmod
      $ gpasswd

      Befehle zur Verwaltung des Shadow-Systems
      $ pwconv               : transferieren der Passwort-Hashes aus passwd -> nach shadow
      $ pwunconv             : shadow -> passwd
      $ pwck                 : Konsistenz von passwd u. shadow ueberpruefen
      $ grpconv
      $ grpunconv
      $ grpck

      $ chown kang:kang myfile     : group and owner
      $ chgrp kim myfile           : nur gruppe aendern

      $ getent passwd kang         : Check a user whether exist or not

      # Generates a compact listing of all the users on the system.
      $ cut -d: -f < /etc/passwd | sort | xargs echo

      /etc/skel                    : automatically copied over to a new user's home directory

    - Der sudo-Mechanismus
      $ visudo                     : editor of sudoers
      $ sudo su                    : simple su is not working at ubuntu
      $ vi /etc/sudoers

    - crontab / anacrontab / at
      $ cat /etc/crontab    : crontable
      $ crontab
      $ cat /var/spool/cron/crontab/kang
      # /etc/cron.{d,daily,hourly,monthly,weekly}
      # /etc/cron.allow            : listed user can access
      # /etc/cron.deny             : listed user cannot access, not cron.allow file
      $ cat /etc/anacrontab

    - Time syncronization
      $ cat /etc/timezone
      $ tzselect                   : set time zone Europe/Berlin
      $ timedatectl set-ntp true   : NTP network time synch is enable

      $ date
      $ hwclock
      $ ntpdate pool.ntp.org       : access to standard ntp server
      $ ntpq -p                    : information about current ntpd server connection
      $ ntpdc                      : ntp diagnose with interactive mode

    - Local information
      $ locale
      $ iconv                   : iconv can use for converting between win(euc-kr) and ubuntu(utf-8)

    - Background prozess
      $ bg 1
      $ fg 1
      $ nohup updatedb &
      $ screen (remote shell)

    - Super user
      /etc/nologin
      /etc/hosts.allow
      /etc/hosts.deny
      $ vi /etc/security/limits.conf
      $ vi /etc/security/access.conf
      $ chsh -s /bin/false kang             : user kang can not access anything!

      /var/run/utmp   : maintains a full accounting of the current status of the system
      /var/log/wtmp   : acts as a historical utmp
      /var/log/btmp   : records only failed login attempts.
      $ who -u        : users information

      $ dmesg         : write kernal message

      $ lspci         : display information PCI buses in the system
      $ lsusb -v      : display information USB buses in the system
      $ lsdev         : display information I/O address, IRQ/DMA channels

      $ iostat        : monitoring system input/output device load
      $ vmstat        : reports virtual memory statistics about processes, memory, paging,
                        block I/O, traps, disks and cpu activity.
      $ mpstat -P 1   : output each available processor, 0 being the first one
      $ free -h       : total amount of physical and virtual memory

      $ w             : Wer ist momentan an System angemeldet? info.  from /var/run/utmp
      $ last          : Wer war momentan an diesem System eingemeldet?
      $ uptime        : how long in service, how many user in machine

      $ lsof /tmp     : open files and corresponding processes.
      $ sar -d        : output disk statistics
      $ fuser         : a block device mounted on that directory

      $ nice          : Prozessprioritaet
      $ renice        : Prozessprioritaet

      $ pgrep         : Wie viele Prozess fuer Kang im Lauf?
      $ pkill         : kill all process of kang?

      $ strace -p program     : Debug program to connect a running process
      $ ltrace cat /dev/null  : Debug program to check a library call tracer

      $ strings /bin/bash     : print characters, useful for reading non-text files.

    - Log system protocol & analysis

      Where is major log files?
      # /var/log/dmesg      : booting message in RAMdisk with Ring buffer
      # /var/log/messages   : system log
      # /var/log/secure     : login log, authentication and authorization privileges
      # /var/spool/cron     : cron logs
      # /var/log/mail.debug : for mail debugging
      $ cat /var/log/*

      Einsatz von Logdateien zur Fehlersuche
      $ less /var/log/messages
      $ tail -f /var/log/messages   : zeigt "Live" neue Zeilen an.
      $ grep sshd /var/log/messages | grep invalide | less

      $ cat /etc/syslog.conf   : log system configuration, syslog-ng gibt auch
      $ cat /etc/rsyslog.conf  : Heute benutzen diese Konfiguration Datei

      $ /sbin/klogd            : kernel message daemon in init-process
      $ /proc/kmsg             : einstellungs Datei von klogd

      Ruuning process with PID
      $ cat /proc/2352/environ
      $ cat /proc/2352/environ | tr "\000" "\n"

      $ logger -t my_log_message  here is my message!

      logrotate in order to save log files by rotation
      /etc/logrotate.conf    : configuration
      /etc/logrotate.d       : contents, references

      wenn Sie systemd statt upstart oder SysVinit, dann journald ist antwortlich.
      $ journalctl --since "2015-01-10" --until "2015-01-11 03:00"

      $ cat /etc/systemd/journald.conf
      $ cat /var/log/journal/    : somtimes not here, but in /var/log/syslog

    - Superdaemon, Einen Rechner absichern
      FTP-Server, LPRd, CUPS, TCP/UDP-Dienste wie Daytime, Echo

      Konfigurationsdatei fuer Super Daemon
      /etc/inetd.d/
      /etc/inetd.conf
      /etc/xinetd.d/
      /etc/xinetd.conf

      TCP-Wrapper konfiguration
      /etc/hosts.allow
      /etc/hosts.deny

      tcpchk: eine inetd.conf auf Syntaxfehler pruefen

    - Monitoring solutions (network and system)
      Nagios, MRTG(Multi Router Traffic Grapher), Cacti, Wireshark, Icinga2
      collectd(system statistics collection daemon for IT infrastructure)
      cloudwatch, rackspace, prometheus    
    
    - Desktops - standard xserver location
      $ crtl+alt+f7
      $ startx         : ein Frontend fuer das eigentliche Startskript xinit
      $ x :1 -query 10.2.11.21  : show a xserver from Centos in tty8 (differ @ VBox)
      $ xhost +10.2.11.23           : Serverseitige Massnahmen (Debian IP)
      $ xdpyinfo  : X-display variables
      $ xwininfo  : window information utility for X-server


#### you must know for system administration
    ===============================================================================================
    my public IP
    ===============================================================================================
    • How do I know my public IP in local machine!
      $ curl ipinfo.io/ip
      $ curl -s ipinfo.io/ip
      $ wget -qO- http://ipecho.net/plain ; echo
      $ dig +short myip.opendns.com @resolver1.opendns.com


    ==============================================================================================
    Howto Jump host
    ===============================================================================================
    • How do I use jump host (local -> server1 -> server2)

      $ ssh -tt server1 ssh server2

      $ ssh -fqN -L2222:server2:22 server1
      $ ssh localhost -p 2222

      $ ssh -o ProxyCommand="ssh server1 nc server2 22" server2
      $ ssh -o ProxyCommand="ssh -W server2:22 server1" server2

      or one can configure server2 via server1
      $ vi ~/.ssh/config
      |Host s2
      |HostName server2
      |User user2
      |IdentityFile ~/.ssh/server2_id_rsa
      |ProxyCommand ssh -W server2:22 server1
      $ ssh s2
      $ ssh user2@s2


#### init & systemd
    ===============================================================================================
    init
    ===============================================================================================
    - Setup to start automatically after a crash or reboot
      Runlevel 0  : System shutdown
      Runlevel 1  : Single-user, rescue mode
      Runlevel 2-4: Multi-user, text mode with networking enabled
      Runlevel 5  : Multi-user, network enabled, graphical mode
      Runlevel 6  : System reboot

    - System V Init Sequence
      1. The init daemon is created from the binary file /sbin/init
      2. The first file the init daemon reads is /etc/inittab
      3. One of the entries in this file decides the runlevel the machine should boot into.
      4. Next, the init daemon looks further into the /etc/inittab file and reads configuration

      Looking at inittab -> rc(run command) -> init directory
      $ cat /etc/inittab | grep initdefault
      $ cat /etc/inittab | grep Runlevel
      $ ls -ld /etc/rc*.d
      $ ls -l /etc/rc2.d
      |S01rsyslog -> ../init.d/rsyslog
      |S02anacron -> ../init.d/anacron
      |S02atd -> ../init.d/atd
      |S02cron -> ../init.d/cron
      |S02mysql -> ../init.d/mysql
      |S02ssh -> ../init.d/ssh
      $ ls -l /etc/init.d/my*
      $ cat /etc/init.d/mysql | less

      Using chkconfig or sysv-rc-conf, alternatively to look init setup
      $ chkonfig --list | grep service_name     : for centOS
      $ sudo apt-get install sysv-rc-conf -y    : for Debian
      $ sudo sysv-rc-conf                       <---- very nice tool!

    - Init for MySQL
      MySQL Startup Behavior at Boot
      $ sudo update-rc.d mysql disable
      $ sudo update-rc.d mysql enable
      $ ls -l /etc/rc2.d

      MySQL Start-up Behavior on Crash
      $ cat /etc/inittab
      | ms:2345:respawn:/bin/sh /usr/bin/mysqld_safe
      $ sudo reboot
      $ ps -ef | grep mysql
      | root    907    1 00:00:00  /bin/sh /usr/bin/mysqld_safe
      |mysql   1031  907 00:00:00  /usr/sbin/mysqld --basedir=/usr ...
      Kill the MySQL
      $ sudo kill -9 907
      $ sudo kill -9 1031
      Wait 5 minutes, then check mysql is still in working!
      $ sudo service mysql status

    ===============================================================================================
    Systemd
    ===============================================================================================
    - Systemd sequence
      runlevel 0 	  poweroff.target
      runlevel 1 	  resuce.target
      runlevel 2-4  multi-user.target
      runlevel 5 	  graphical.target
      runlevel 6 	  reboot.target

      /lib/systemd/system/
      /etc/systemd/system/

      Looking at the default.target File and Dependencies
      $ sudo ls -l /etc/systemd/system/default.target
      | ... /etc/systemd/system/default.target -> /lib/systemd/system/multi-user.target

      $ sudo ls -l /etc/systemd/system/multi-user.target.wants/*.service
      |/etc/.../multi-user.target.wants/crond.service -> /usr/lib/systemd/system/crond.service
      |/etc/.../multi-user.target.wants/mysqld.service -> /usr/lib/systemd/system/mysqld.service
      | ...
      |/etc/.../multi-user.target.wants/sshd.service -> /usr/lib/systemd/system/sshd.service

      $ sudo systemctl show --property "Wants" multi-user.target | fmt -10 | grep mysql
      | Requires=basic.target

      $ sudo systemctl show --property "Requires" basic.target | fmt -10
      | Requires=sysinit.target

      $ sudo systemctl show --property "Wants" sysinit.target | fmt -10
      |Wants=local-fs.target
      |swap.target
      |cryptsetup.target
      |systemd-udevd.service
      |systemd-update-utmp.service
      |systemd-journal-flush.service
      |...

      Looking at a Unit File
      $ sudo nano /etc/systemd/system/multi-user.target.wants/sshd.service
      |[Unit]
      |Description=OpenSSH server daemon
      |After=syslog.target network.target auditd.service
      |[Service]
      |EnvironmentFile=/etc/sysconfig/sshd
      |ExecStartPre=/usr/sbin/sshd-keygen
      |ExecStart=/usr/sbin/sshd -D $OPTIONS
      |ExecReload=/bin/kill -HUP $MAINPID
      |KillMode=process
      |Restart=on-failure
      |RestartSec=42s
      |[Install]
      |WantedBy=multi-user.target

    - systemd + mysql
      MySQL Startup Behavior at Boot
      $ sudo systemctl disable mysqld.service
      $ sudo systemctl enable mysqld.service
      $ sudo systemctl show --property "Wants" multi-user.target | fmt -10 | grep mysql
      $ sudo ls -l /etc/systemd/system/multi-user.target.wants/mysql*

      MySQL Startup Behavior on Crash
      $ sudo nano /etc/systemd/system/multi-user.target.wants/mysqld.service
      |[Unit]
      |...
      |[Install]
      |...
      |[Service]
      |...
      |Restart=always               <--- this is important piece
      |...
      $ sudo systemctl daemon-reload
      $ sudo systemctl restart mysqld.service
      $ sudo systemctl status mysqld.service
      $ sudo kill -9 11217
      Still survice mysql as wish
      $ sudo systemctl status mysqld.service

#### Linuix packages
    ===============================================================================================
    Binary packages
    ===============================================================================================
    - dpkg:
      Originally used by Debian and now by Ubuntu. Uses the .deb format and was the first to have
      a widely known dependency resolution tool, APT. The ncurses-based front-end for APT,
      aptitude, is also a popular package manager for Debian-based systems.

    - RPM Package Manager:
      Created by Red Hat. RPM is the Linux Standard Base packaging format and the base of a
      number of additional tools, including apt4rpm, Red Hat's up2date, Mandriva's urpmi,
      openSUSE's ZYpp, PLD Linux's poldek, and YUM, which is used by Fedora, Red Hat Enterprise
      Linux, and Yellow Dog Linux.

    - dpkg
      $ dpkg -Gi package(s).deb          install/upgrade package file(s)
      $ dpkg -r package                  remove package
      $ dpkg -l '*spell*'                show all packages whose names contain the spell
      $ dpkg -l package                  show version of package installed
      $ dpkg -s package                  show all package metadata
      $ dpkg -I package.deb              show all package file's metadata
      $ dpkg -S /path/file               what package does file belong
      $ dpkg -L package                  list where files were installed
      $ dpkg -c package.deb              list where files would be installed
      $ dpkg -x package.deb              extract package files to current dir
      $ dpkg -s package | grep ^Depends  list files/packages that package needs
      $ dpkg --purge --dry-run package	 list packages that need package (see also whatrequires)

      $ dpkg -b example
      $ dpkg-deb --build helloworld_1.0-1
      | Package: backup-script
      | Architecture: all
      | Maintainer: Bas van Schaik
      | Depends: debconf (>= 0.5.00), rsync
      | Priority: optional
      | Version: 0.5
      | Description: My Simple backup script
      | This script provides an easy way of creating backups
      | .
      | Creating backups is now more fun than ever!

    - rpm
      $ rpm -Uvh packages(s).rpm          install/upgrade package file(s)
      $ rpm -e package                    remove package
      $ rpm -qa '*spell*'                 show all packages whose names contain the spell
      $ rpm -q package                    show version of package installed
      $ rpm -q -i package                 show all package metadata
      $ rpm -q -i -p package.rpm          show all package file's metadata
      $ rpm -q -f /path/file              what package does file belong
      $ rpm -q -l package                 list where files were installed
      $ rpm -q -l -p package.rpm          list where files would be installed
      $ rpm2cpio package.rpm | cpio -id   extract package files to current dir

      $ rpmdev-newspec
      $ rpmbuild -ba hello.spec
      | Name:     hello
      | Version:  2.8
      | Release:  1
      | Summary:  The "Hello World" program from GNU
      | License:  GPLv3+
      | URL:      https://www.gnu.org/software/hello/
      | Source0:  http://ftp.gnu.org/gnu/hello/hello-2.8.tar.gz
      | %description
      | The "Hello World" program, done with all bells and whistles of a proper FOSS
      | project, including configuration, build, internationalization, help files, etc.
      | %changelog
      | * Thu Jul 07 2011 The Coon of Ty <Ty@coon.org> - 2.8-1
      | - Initial version of the package



<br/><a name="HA"></a>
## High Availability

- LVS (Linux Virtual Server)
    LVS is a highly scalable and available server built on a cluster of real servers, with the load balancer running on the Linux operating system.

  LVS components
  * lvs daemon
  * ipvsadm
  * iptables
  * acls

  LVS Forwarding
  * Network Address Translation (NAT)
  * Direct Routing
  * Tunneling
  * Local Node


- IPVS (IP Virtual Server)
	IPVS is incorporated into the LVS, where it runs on a host and acts as a load balancer in front of a cluster of real servers.
	usually called Layer-4 switching. IPVS running on a host acts as a load balancer

- Virtual Router Redundancy Protocol (VRRP)
	VRRP is a computer networking protocol that provides for automatic assignment of available IP routers to participating hosts.

- keepalived
	is a routing software written in C. The main goal is to provide robust facilities for
	loadbalancing and high-availability to Linux based infrastructures.
	Internally keepalived uses VRRP.

- ldirectord
	is a daemon to monitor and administer real servers in a LVS cluster of load balanced
	virtual servers. ldirectord typically used as a resource for HAProxy.

- HAProxy
	provides a HA load balancer and proxy server

- Nginx as a load balancing

- Failover clusters
	When the VM is temporarily stopped, snapshotted, moved, and then resumed on the new

- Pacemaker
	A scalable High Availability cluster resource manager.

- Fencing
  isolation of a failed node so that it does not cause disruption to a computer cluster.

- STONITH
	Shoot The Other Node In The Head (STONITH) is a technique for fencing.

- HeartBeat
  enables the highly available operation of services

- Corosync and Pacemaker
  allows to create a high availability (HA) server infrastructure with a Reserved IP

- OpenAIS (Open Implementation of the Application Interface Specification)

- CMAN (Oracle connection manager)



<br/><a name="Service"></a>
## Service
#### Services
    ===============================================================================================
    Services
    ===============================================================================================
    - Mail
      SMTP 25  : default SMTP
      SMTP 465 : to send messages using SMTP securely
      IMAP 143 : non-encrypted port
      IMAP 993 : using IMAP securely
      POP3 110 : default POP3 non-encrypted port
      POP3 995 : using POP3 securely

      /var/spool/mail   : delievered by MDA
      /var/spool/mqueue : auszuliefernde Mail-Queue

      Mail alias by root
      $ vi /etc/aliases

      SMTP mail server
      Postfix, sendmail, exim  qmail

      MDA, POP and IMAP server
      dovecot, courier

      MDA(mail delivery agent)
      Procmail

      //General way to test
      $ netcat localhost 25
      $ telnet localhost 25

    - FTP
      FTP client Port 21 ---> FTP Server Port 20
      vsftp Pure-FTPd  ProFTPD

    - printer
      BSD   -> Apple
      SysmV -> Oracle
      CUPS  -> Common Unix Printing System by Apple

    - SSH
      SSH tunneling
      $ ssh destination -L 4711:server:port

      SSH public key technic
      /etc/ssh/sshd_config
      /etc/ssh/ssh_config
      /etc/hosts.allow
      /etc/hosts.deny
      /etc/nologin
      /etc/ssh/ssh_known_hosts
      /etc/sshrc

      ssh-keygen -t dsa

      ssh-agent bash  : in memory protect user's private key
      ssh-add         : one can add private key

    - gpg (GNU Privacy Guard)

    - Database
      MySQL
      sql> USE
      sql> CREATE TABLE
      sql> INSERT INTO
      sql> SELECT FROM
      sql> UPDATE SET  WHERE
      sql> DROP TABLE
      sql> DROP DATABASES

    - Leading Web Server
      Apache, Microsoft-IIS, nginx, Tomcat, Node.js
      Proxy Server: HAProxy, Nginx, Squid, Varnish are mostly used

      Apache
      /etc/apache2/apache2.conf  @ Debian
      /etc/httpd/conf/httpd.conf @ CentOS

      htpasswd can create a password. list to allow access
      $ ./htpasswd kim
      $ vi .htaccess
      $ vi .htgroup

      Apache Module
      /usr/src/mod_php,mod_perl,mod_auth
      OpenSSL(Secure Sockets Layer) + Apache =  Apache-SSL -> mod_ssl

      Certificates are usually stored in /etc/ssl/ or /etc/pki/.
      /etc/ssl/    : the standard location for OpenSSL configuration
      /etc/pki/    : the standard location for PKI (Puclbic Key Infrastructure)

      Nginx with firewall @ CentOS (optional)
      $ sudo firewall-cmd

    - Samba
      smbd, nmbd, smbstatus, smbpasswd, cifs

    - NFS(Network File System)
      exportfs, nfsstat, showmout, rpcinfo    at server
      fstab, mount                            at client

    - Securing NFS
      The tcp wrapper / Firewall software can be used to limit access to an NFS server.
      disadvantage of iptables
      TCP Wrapper restrict access by matching usernames, but iptables does not support.

    - DHCP
      relay agent

    - LDAP
      LDAP permission by SSSD (System Security Services Daemon) to authentication resource
      LDIF (LDAP Data Interchange Format) and (dn: uid=kang, ou=users, dc=linux, dc=net)
      slapadd, slapcat, slapindex
      ldapadd, ldapsearch, ldappasswd, ldapdelete

    - PAM (Pluggable Authentication Modules)
      /lib/security/pam_ldap.so   : configures authentication via LDAP.
      /lib/security/pam_securetty : user allow to log in as root, when /etc/securetty exists

      Those data location is related with PAM modules
      /etc/security/opasswd       : old password is saved into
      /etc/security/limits.d      : default limits are taken from
      /etc/security/limits.conf   : configuration of limitatio

      If you want to deny some users from ssh connection,
      $ vi /etc/nosshuser
      $ vi /etc/pam.d/sshd
      | auth required pam_listfile.so item=user sense=deny file=/etc/nosshuser

      If you want to allow users, then do this
      $ vi /etc/sshuser
      $ vi /etc/pam.d/sshd
      | auth required pam_listfile.so item=user sense=allow file=/etc/sshuser

      Simple way to deny any user login
      $ vi /etc/nologin
      $ vi /etc/pam.d/login




<br/><a name="Storage"></a>
## Storage
#### Disk and Storage in Linux
    ===============================================================================================
    Disk and Storage
    ===============================================================================================
    - check current partition
      $ cat /proc/paritions
      $ fdisk -l

    - To display mounted filesystems
      $ fdisk -l
      $ df                : simple and easy
      $ cat /etc/mtab     : check mount option from data table
      $ cat /proc/mounts  : mounted device in current process/session
      $ mount             : list all mounted device currently

    - Automatische Mounten file system via /etc/fstab (6 fields)

    - Disk free (df)  : Displays information on mounted filesystems
      $ df -i   : zeigt mit Inode nicht mit Block

    - Disk utilization (du) : esimate file space usage
      $ du -a   : all

    - create new partion
      $ fdisk /dev/sdb  : MBR partition (4 Primary, 4T total and limit 2.2TB/partition)
      $ gdisk /dev/sdc  : GPT partion   (128 Primary, GUID partition, nur Primary)
      $ parted          : nice method

    - File systems
      ReiserFS, Btrfs, msdos, vfat, ntfs, xfs, cramfs, jfs

    - Formatting/Creating filesystems
      $ mkfs

    - Swap fundamental
      $ cat /proc/swaps
      $ dd if=/dev/zero of=/swapfile bs=1024 count=524288
      $ mkswap
      $ swapon
      $ swapoff

    - chceking filesystems
      $ fsck -c /dev/sdb1
      $ e2fsck -c /dev/sdb1
      $ badbocks /dev/dab1

    - Modyfying, Checking And Repairing Filesystems
      debugfs
      dumpe2fs
      e2fsck
      e2image
      mke2fs
      tune2fs

    - Disk Quotas
      $ quota 	       : see your quota
      $ quotacheck -augv     : all user group verbose, directory quota
      $ quotaon  -avug       : all user group verbose
      $ quataoff -avug       : all user group verbose
      $ edquota -u root      : for root
      $ repquota -v /home    :  Generates quota reports

    - Attribute of directory
      $ lsattr     	: list of attribute
      $ chattr 	: change of attribute

    - smart
      Self monitoring analysis and reporting technology to monitor hard drive
      $ smartctl -i /dev/sda    : info. about model, serial number, firmware ver.

    - Automounter
      normally "hald" and "dbus" daemon has been used for mount-automatization of drives
      but network resouce "autofs" is better, consists of a kernel component and a daemon

      $ vi /etc/auto.master
      $ vi /etc/auto.misc
      $ /etc/init.d/autofs restart              : apply permanently
      /xxx/xxx will be created by auto.master and auto.netz

    - Encrypted file systems
      Encryption algorithms : Twofish, AES, DES
      A virtual block is created in /dev/mapper (device mapper). All data to and from it goes
      to an encryption or decryption filter before being mapped to another blockdevice

      all relevant modules should be loaded at boot time
      # echo aes >> /etc/modules
      # echo dm_mod >> etc/moduls
      # echo dm_crypt >> /etc/moduls
      # modprobe -a aes dm_mod dm_crypt

      Set up an encrypted filesystem
      $ cryptsetup luksFormat /dev/sdb1         : use /dev/sdb1 partition
      > *****************                       : type the password
      $ cryptsetup luksOpen /dev/sdb1 safe      : create device mapper @ /dev/mapper/safe
      $ mkfs.ext2 /dev/mapper/safe		  : format filesystem
      $ mkdir /safe                             : need a mount point
      $ mount /dev/mapper/safe /safe		  : mount it

    - List out information all block devices
      block devices are the hard drive partitions and other storage devices
      $ lsblk
      |NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
      |sda      8:0    0 465.8G  0 disk
      |├─sda1   8:1    0    70G  0 part
      |├─sda2   8:2    0     1K  0 part
      |├─sda5   8:5    0  97.7G  0 part /media/4668484A68483B47
      |├─sda6   8:6    0  97.7G  0 part /
      |├─sda7   8:7    0   1.9G  0 part [SWAP]
      |└─sda8   8:8    0 198.5G  0 part /media/13f35f59-f023-4d98-b06f-9dfaebefd6c1
      |sr0     11:0    1  1024M  0 rom

    - RAID configuration
      $ mdadm                : raid storage
      $ sfdisk               : fancy method
      $ resize2fs /dev/md0   : repossible expand without unmount

    - Adjusting storage device access
      $ hdparm              : IDE/SATA device harddisk standard information
      $ sdparm --enumerate  : summary of SCSI device

    - ISCSI
      Network transmission of scsi protocol via TCP connection
      SCSI (Small Computer System Interface)
      Server : iSCSI-Target
      Client : iSCSI-Initiator

      iscsitarget
      ietd.conf
      iscsid
      iscsiadm
      tgtd

    - WWID, WWN, LUN
      SCSI, SATA, SAS, Fibre has an unique identification by
      SAS (Serial Attached SCSI) and SATA (Serial ATA)
      WWID : World Wide ID        : find at /dev/disk/by-id/
      WWD  : World Wide Name 	    : correspond to WWID
      LUNs : Logical Unit Nummber : is used to address a SCSI device

      If there are multiple paths from a system to a device, a special kernel-module
      and associated daemons and other software will use the WWID to detect the paths.
      /dev/mapper/wwid will be created by them.

      LUN persistence with udev+scsi_id
      $ scsi_id -g -u -s /block/sdc    : find WWID
      $ /lib/udev/scsi_id --page=0x80 --whitelisted /dev/sdb

      LUN persistence can also be made with multipath
      $ multipath -l
      $ cd /dev/mpath/backupdisk

    - LVM (Logical Volume Manager)
      /sbin/pv*   : physical volume - a real partitions with administrative data
      /sbin/lv*   : logical volume - extend block introduced inside volume group
      /sbin/vg*   : volume group - mehreren physikalischen Volumen

      Device mapper at LVM /proc/mapper
      The device mapper is a kernel driver that provides a framework for volume management.
      LVM logical volumes are activated using the device mapper.

      Partition of device(disk)
      $ fdisk,sfdisk,vgscan

      create a physical volume
      $ pvcreate, pvdisplay

      configuration of volume group
      $ vgcreate, vgdisplay

      configuraion of logical volume
      $ lvcreate, lvdisplay

      Format of LV
      $ mkfs.ext4, mkdir, mount

      Modifying of LV
      $ lvextend, resize2fs, xfs_growfs

      Verkleinern of LV
      $ umount, resize2fs, lvreduce

      Delete PV
      $ vgreduce, vgextend vg_big /dev/sdc1

      LVM snapshots
      $ lvcreate

      If file systems are upgraded and have to move data to new one.
      $ pvmove

      Activate If you meet machine crash, emergency boot, and activate LVM device
      $ vgchange

      Rename of VG and LV
      $ vgrename, lvrename

    - DRBD (Distributed Replicated Block Device)
      is a software-based, shared-nothing, replicated storage solution mirroring the content
      of block devices (hard disks, partitions, logical volumes etc.) between servers.

      DRBD's core functionality is implemented by way of a Linux kernel module.
      DRBD constitutes a driver for a virtual block device

      LVM setup for DRBD
      lvm, vgchange, drbdadm, vgscan(vgs)

      DRBD with pacemaker
      pacemaker + crm + CIB(Cluster Information Base)

      DRBD with HeartBeat
      Heartbeat + CRM + CIB(xml)

    - DLM (Distributed Lock Manager)
      A distributed lock manager (DLM) provides distributed software applications with a
      means to synchronize their accesses to shared resources. A lock manager is a traffic
      cop who controls access to resources in the cluster, such as access to a GFS

    - GFS2
      Global File System 2 (GFS2) is a shared disk file system for Linux clusters.
      GFS2 + cLVM(LVM2) + DLM + pacemaker

    - OCFS2
      Oracle Cluster File System (OCFS2) is a shared disk file system

      O2CB manages the shared file access within a cluster of servers
      O2CB cluster stack: Node Manager, Heartbeat, TCP, DLM & DLMFS, CONFIGFS

      OSFS2 + pacemaker + DLM + O2CB + STOHICH

    - Other clustered file systems
      Coda, CephFS, GlusterFS, AFS(Andrew File System), lustre, HDFS, DFS(win), EVMS


#### HANA DB and Storage

    ===============================================================================================
    Upgrade of 'HANA' volume size
    ===============================================================================================
    1. Create the volume in the monsoon dashboard with 200GB volume size

        volume name   : lw_testbase_volume
        volume id     : vol-7ecfa92a
        volume region : Rot DC2
        volume device : /dev/xda (xda=sdb)

    2. Login to the server and perform the following steps

      • In order to get rid of filtering issue of "device /dev/xda not found (or ignored by filtering)"
        I have to comment out filter

        $  vi /etc/lvm/lvm.conf
        | # filter = [ "r|/dev/.*/by-path/.*|", "r|/dev/.*/by-id/.*|", "r|/dev/fd.*|", "r|/dev/cdrom|", "a/.*/" ]
        | filter = [ "r|/dev/fd.*|", "r|/dev/cdrom|", "a/.*/" ]

      • then created file system and copy all HANA related contents into new and extended vlolume place
        $ pvcreate /dev/monsoon/vol-7ecfa92a
        $ vgcreate vg_hana /dev/monsoon/vol-7ecfa92a

        $ lvcreate -l 100%FREE -n lv_hana vg_hana
        $ mkfs.xfs /dev/vg_hana/lv_hana

        $ mkdir /sapmnt/hana

        $ vi /etc/fstab
        | /dev/vg_hana/lv_hana   /sapmnt/hana              xfs defaults  0  0
        $ mount -a

        $ mkdir -p /sapmnt/hana/uar/sap
        $ chown root:sapsys /sapmnt/hana/usr/sap
        $ rsync -av /usr/sap/ /sapmnt/hana/usr/sap/

        $ mkdir -p /sapmnt/hana/hana/{data,log,shared,backup/{data,log}}
        $ chown root:sapsys /sapmnt/hana/*
        $ rsync -av /hana/ /sapmnt/hana/hana/

        $ vi /etc/fstab
        | /sapmnt/hana/usr/sap          /usr/sap           none bind 0 0
        | /sapmnt/hana/hana/data        /hana/data         none bind 0 0
        | /sapmnt/hana/hana/log         /hana/log          none bind 0 0
        | /sapmnt/hana/hana/shared      /hana/shared       none bind 0 0
        | /sapmnt/hana/hana/backup/data /hana/backup/data  none bind 0 0
        | /sapmnt/hana/hana/backup/log  /hana/backup/log   none bind 0 0
        $ mount -a

#### Upgrade of HANA DB
    ===============================================================================================
    Upgrade of HANA volume size
    ===============================================================================================
    1. Command sets
      $ sudo su -
      $ sudo -i
      $ su - hdbadm
      $ su - root

      $ shutdown -r -t 4 now
      $ poweroff
      $ shutdown -h

      $ df -h
      $ df -alh

      $ lsblk
      $ fdisk -h
      $ fdisk /dev/xvdb
      $ mount /dev/xvdb1 /mnt/
      $ mount -a
      $ mkfs.xfs /dev/xvdb1
      $ mount /deb/xvdb1 sysfiles/

      $ cp -R . /mnt/ -v
      $ rsync -av /hana/log/HDB/ /mnt/log/

      $ service --status-all

      $ lsof | grep hana

      $ screen
      $ screen -A -D

      $ mount /dev/xvdb1 sysfiles/
      $ mount /dev/xvdc1 data/
      $ mount /dev/xvdd1 log/

      $ /etc/init.d/sapinit stop
      $ /etc/fstab

    2. Case for lots of volumes: scripts for LVM
      $ pvcreate /dev/xvde
      $ vgextend vgcal /dev/xvde
      $ pvmove --alloc anywhere /dev/xvdj /dev/xvde

      $ lvextend -l +100%FREE /dev/mapper/vgcal-dbdata
      $ resize2fs /dev/mapper/vgcal-dbdata
      $ xfs_growfs /dev/mapper/vgcal-dbdata

      $ vi create_lvm_volume.sh
      |!/bin/bash
      | for i in (/dev/xvdn /dev/xvdm /dev/xvdl /dev/xvdk /dev/xvdj /dev/xvdi /dev/xvdh
      |            /dev/xvds /dev/xvdr /dev/xvdq /dev/xvdp /dev/xvdo);
      | do
      |     pvmove $i /dev/xvde
      | done

    3. LVM suggestion from PCS team
      $ pvcreate $NEUES_VOLUME
      $ vgextend vgcal /dev/$NEUE_VOLUME

      -- Für jedes vorhandene Physical Volume
      $ pvmove --alloc anywhere $ALTES_PV $NEUEV_VOLUME

      -- Alte Volumes aus Volume Group entfernen
      $ vgreduce vgcal /dev/xvdh /dev/xvdi /dev/xvdj
      $ lvextend +L100%FREE /dev/mapper/vgcal-dbdata
      $ resize2fs  /dev/mapper/vgcal-dbdata

      - oder ein Alternative wäre
      $ xfs_growfs /hana/data/HDB


#### Increase LVM Volume
    ===============================================================================================
    Increase LVM volume (from LPIC note)
    ===============================================================================================
    • LVM
      Logical Volume Manager is an abstraction of physical disk devices and volumes  to volume groups (a virtual disk, multiple disks and storage pool)

        /sbin/pv*   : physical volume - a real partitions with administrative data
        /sbin/lv*   : logical volume - extend block introduced inside volume group
        /sbin/vg*   : volume group - mehreren physikalischen Volumen

      Device mapper at LVM /proc/mapper:
        The device mapper is a kernel driver that provides a framework for volume management.
        It provides a generic way of creating mapped devices, which may be used as LV
        LVM logical volumes are activated using the device mapper.
        Each logical volume is translated into a mapped device.
        Each segment translates into a line in the mapping table that describes the device.

    • Creation of LVM
      1.LVM installation
        $ yum install lvm2
        $ apt-get install lvm2

      2.Partition of device(disk)
        $ fdisk /dev/sdb
        > n,p,1,t
        > 8e
        > w
        $ sfdisk -d /dev/sdb | sfdisk /dev/sdc
        $ sfdisk -d /dev/sdb | sfdisk /dev/sdd
        $ sfdisk -d /dev/sdb | sfdisk /dev/sde
        $ vgscan -v       : sucht angeschlossene Festplatten nach vg und auch pv!

      3.create a physical volume
        $ pvcreate -v /dev/sdb1
        $ pvcreate -v /dev/sdc1
        $ pvcreate -v /dev/sdd1
        $ pvcreate -v /dev/sde1
        $ pvdisplay

      4.configuration of volume group
        $ vgcreate vg_dig /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sde1
        $ vgdisplay

      5.configuraion of logical volume
        $ lvcreate -n lv_big_1 -L 20G vg_big
        $ lvdisplay

      6.Format of LV
        $ mkfs.ext4 /dev/vg_big/lv_big_1
        $ mkdir /mnt
        $ mount /dev/vg_big/lv_big_1 /mnt     : mapper start to come into play
        > /dev/mapper/vg_big-lv_big_1 on /mnt type ext4 (rw)
        $ cp /boot/*  /mnt/

    • Modifying of LV
      Q) If you add some more disk space within Logiral Volume? "lvextend"
        $ lvextend -L 25G /dev/vg_big/lv_big_1
        $ lvextend -L +5G /dev/vg_big/lv_big_1
        $ resize2fs /dev/vg_big/lv_big_1         : automatic
        $ xfs_growfs /dev/vg_big/lv_big_1        : if xfs filesystem is used

      Q) if you want to resize/reduce LV? "lvreduce"
        $ umount /lvtest                         : absolutely neccessary umount
        $ e2fsck -f /dev/vg_big/lv_big_1         : test healthy
        $ resize2fs /dev/vg_big/lv_big_1 1024000 : here is a blcok x 4k = 4GB
        $ lvreduce -L 4G /dev/vg_big/lvbig_1     : also do verkleinern for LV

      Q) if you want to delete physics volume from volume group? "vgreduce, vgextend"
        $ vgreduce -a vg_big              : 4 partition to 1
        $ vgextend vg_big /dev/sdc1       : redefine only first partition into volume group

      Q) LVM snapshots
        the snapshot logical volume only saves data blocks from the original logical volume
        that are changed in the original
        $ lvcreate -L 1G -s -n backup /dev/vg_big/lv_big_1
        $ mount /dev/vg_big/backup /backup
        $ tar -pzcf backup.tar.gz  /backup
        $ umount /backup
        $ lvremove /dev/vg_big/backup
        > y

      Q) If file systems are upgraded and have to move data to new one.
        $ pvmove   /dev/hdb2  /dev/sdc1       : move hdb2 data into sdc1

      Q) Activate If you meet machine crash, emergency boot, and activate LVM device
        $ vgchange -ay            : activate all known volume group's device

      Q) Rename of VG and LV
        $ vgrename vg_orignal vg_new
        $ lvrename MyLVM debian fedora

      Q) What command is used to make an exact copy of a logical volume for backup purposes?
        $ lvcreate (no lvsnapshot)

    • Remark
      sdc (full device) can also be used a volume group, not only sdc1 or sdc2!


#### Storage area network (SAN)
    ===============================================================================================
    SAN
    ===============================================================================================
    - Storage area network (SAN)
      is a network which provides access to consolidated, block level data storage. SANs are
      primarily used to enhance storage devices, such as disk arrays, tape libraries, and optical
      jukeboxes, accessible to servers so that the devices appear to the operating system as
      locally attached devices. A SAN typically has its own network of storage devices that are
      generally not accessible through the local area network (LAN) by other devices.
      The cost and complexity of SANs dropped in the early 2000s to levels allowing wider
      adoption across both enterprise and small to medium-sized business environments.
      A SAN does not provide file abstraction, only block-level operations. However, file systems
      built on top of SANs do provide file-level access, and are known as shared-disk file systems.


<div><br/>
&raquo; Back to <a href="#contents">Contents</a> | <a href="../docs/README.md">Docs</a>
</div>
